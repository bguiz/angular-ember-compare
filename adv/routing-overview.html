<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Routing | Angular-ember-compare</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="bguiz">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../adv/routers.html" />
        
        
        <link rel="prev" href="../mvc/controllers.html" />
        

        <meta property="og:title" content="Routing | Angular-ember-compare">
        <meta property="og:site_name" content="Angular-ember-compare">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/bguiz">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
    </head>
    <body>
        
<div class="book" data-github="bguiz/angular-ember-compare" data-level="3" data-basepath=".." data-revision="1399986322474">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/bguiz/angular-ember-compare" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/bguiz/angular-ember-compare/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/bguiz/angular-ember-compare/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="../" >Angular-ember-compare</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        <li>
            <a href="https://github.com/bguiz" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/bguiz/angular-ember-compare/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/bguiz/angular-ember-compare/edit/master/adv/routing-overview.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="intro/criteria.html">
                
                <a href="../intro/criteria.html">
                    <i class="fa fa-check"></i> <b>1)</b> Criteria
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="mvc/mvc-overview.html">
                
                <a href="../mvc/mvc-overview.html">
                    <i class="fa fa-check"></i> <b>2)</b> MVC
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="mvc/models.html">
                            
                            <a href="../mvc/models.html">
                                <i class="fa fa-check"></i> <b>2.1)</b> Models
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="mvc/views-templates.html">
                            
                            <a href="../mvc/views-templates.html">
                                <i class="fa fa-check"></i> <b>2.2)</b> Views and Templates
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="mvc/controllers.html">
                            
                            <a href="../mvc/controllers.html">
                                <i class="fa fa-check"></i> <b>2.3)</b> Controllers
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="adv/routing-overview.html">
                
                <a href="../adv/routing-overview.html">
                    <i class="fa fa-check"></i> <b>3)</b> Routing
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="adv/routers.html">
                            
                            <a href="../adv/routers.html">
                                <i class="fa fa-check"></i> <b>3.1)</b> Routers
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="adv/components.html">
                
                <a href="../adv/components.html">
                    <i class="fa fa-check"></i> <b>4)</b> Components
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="roundup/roundup.html">
                
                <a href="../roundup/roundup.html">
                    <i class="fa fa-check"></i> <b>5)</b> Round Up
                </a>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body" tabindex="-1">
        <div class="body-inner">
            <div class="page-wrapper">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 66.66666666666667%;min-width: 55.55555555555556%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../intro/criteria.html" title="Criteria" class="chapter done new-chapter" data-progress="1" style="left: 11.11111111111111%;"></a>
    
        <a href="../mvc/mvc-overview.html" title="MVC" class="chapter done new-chapter" data-progress="2" style="left: 22.22222222222222%;"></a>
    
        <a href="../mvc/models.html" title="Models" class="chapter done " data-progress="2.1" style="left: 33.333333333333336%;"></a>
    
        <a href="../mvc/views-templates.html" title="Views and Templates" class="chapter done " data-progress="2.2" style="left: 44.44444444444444%;"></a>
    
        <a href="../mvc/controllers.html" title="Controllers" class="chapter done " data-progress="2.3" style="left: 55.55555555555556%;"></a>
    
        <a href="../adv/routing-overview.html" title="Routing" class="chapter done new-chapter" data-progress="3" style="left: 66.66666666666667%;"></a>
    
        <a href="../adv/routers.html" title="Routers" class="chapter  " data-progress="3.1" style="left: 77.77777777777777%;"></a>
    
        <a href="../adv/components.html" title="Components" class="chapter  new-chapter" data-progress="4" style="left: 88.88888888888889%;"></a>
    
        <a href="../roundup/roundup.html" title="Round Up" class="chapter  new-chapter" data-progress="5" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_4">
                    
                        <h2 id="routing">Routing</h2>
<p>Routing is a mechanism which keeps the state of a web application in sync with its URL.
That is, when its URL changes, the app is notified that it should transition to a new state.
Conversely, when the app transitions to a new state, it updates the URL.</p>
<p>If this sounds like familiar territory, that is because it is!
Whenever using a traditional website -
where the page refreshes upon each navigation -
this is precisely what happened.
One page, one URL.</p>
<p>However, when building a single page application,
we do not get this by default, and the SPA framework,
such as AngularJs or EmberJs, needs to take care of this for us.
Before we get into that however, let us take a step back,
to understand why routing is important,
and why it continues to be relevant with the advent of single page applications.</p>
<ul>
<li>Routing is what we are already used to when browsing the web;
when we navigate to a different &quot;page&quot; we expect it to have a different URL</li>
<li>Browser history: We expect to be able to use the back and forward buttons
while browsing web sites</li>
<li>URL sharing: We have an expectation that by copying the URL from the browser&#39;s
address bar, and sharing that with others, when they open that URL,
they go to a similar state within the web app. Also known as deep linking.</li>
<li>Deep linking for packaged apps: SPAs can be packaged into native apps,
using tools such as Phonegap. If a SPA that is packaged within an app
supports routing, we can deep link to specific parts of that app.</li>
</ul>
<p>Thus we can see that it is important for us to support routing,
as its absence will detract from the experience and expectations set by existing apps.
Before we take a look at how routing is implemented in AngularJs and EmberJs,
let us look at URLs in single-page applications</p>
<h3 id="urls-in-single-page-applications">URLs in Single-Page Applications</h3>
<p>In single-page applications, the URL is technically always the same,
because technically, we are always on the same page.
We <em>pretend</em> to navigate between different pages,
by using Javascript to replace large sections of the DOM.</p>
<p>However, this would mean that we would lose  the benfits of our app being URL-driven.
Thankfully there are a couple of different techniques to enable routing to occur.</p>
<h4 id="method-1-hash-fragments">Method 1: Hash Fragments</h4>
<p>Hash fragments have been around since the early days of the Internet,
predating single-page applications, and even Javascript!</p>
<p>Their usage was very simple though.
When you had a webpage that was rather long, and you wished to link to a different
section on the same page, rather than to a different page,
you would do something like this, in your HTML:</p>
<pre><code>    &lt;<span class="hljs-operator">a</span> href=<span class="hljs-string">"#partOfPageManyScrollsAway"</span>&gt;
        Clicking here will jump <span class="hljs-built_in">to</span> <span class="hljs-operator">a</span> part <span class="hljs-operator">of</span> <span class="hljs-operator">the</span> page that is many scrolls away
    &lt;/<span class="hljs-operator">a</span>&gt;
</code></pre><p>&hellip; and somewhere else <em>in the same document</em>, we will have:</p>
<pre><code>    <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"partOfPageManyScrollsAway"</span>&gt;</span>
        You sure got here quickly!
    <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
</code></pre><p>As you may have guessed, clicking on the first <code>&lt;a&gt;</code> tag
would scroll the second <code>&lt;a&gt;</code> tag into view in the browser.</p>
<p>&hellip; but that is not all!
If you look in the address bar, you will find that the URL has been suffixed with
<code>#partOfPageManyScrollsAway</code>.
When you click on the back button,
you go back to where you were originally within the page - the first <code>&lt;a&gt;</code> tag
When you click the forward button now,
you go back to the second <code>&lt;a&gt;</code> tag again.</p>
<p>You can try this out for yourself!
Go to any article of <a href="http://en.wikipedia.org" target="_blank">Wikipedia</a>
and find citations in line with the text.
Many of these are hyperlinks to other <code>&lt;a&gt;</code> tags
that are at the bottom of the page, in the list of citations.
Click on a few of these in a row, and then use the back and forward buttons.</p>
<p>This was the only way (until recently),
where the browser&#39;s URL could change without navigating to a different page,
<strong>and</strong> forward and back buttons continue working (browser history preserved).
Given this, the developers of SPA frameworks decided to use this as the means
to store the URL of SPA&#39;s current route.
That is, as far as the SPA was concerned, it own internal URL was the hash fragments.
Thus, instead of using words and numbers in hash fragments,
they simply used the URL path instead.
For example: <code>#/foo/123</code> or <code>#/bar/123/edit</code></p>
<h4 id="method-2-history-api">Method 2: History API</h4>
<p>More recently, however, browsers have started implementing the HTML5 specification.
The History API is part of this spec.</p>
<p>It accomplishes something very similar to the hash fragment method,
except that the <code>#</code> symbol is no longer present in the URL.
That would mean that the end user would be unable to distinguish
a single page application from a traditional website -
not without firing up the developer&#39;s console in a browser anyway.</p>
<p>How the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history" target="_blank">History API</a>
accomplishes this is for the server to serve the same file -
the <code>index.html</code> of the single page app -
for all URL paths that match its routes.
Subsequently the SPA itself will use the functions in the
History API to alter the the URL in the address bar,
<em>without</em> reloading the page.
It also also listens for changes in the URL in the address bar,
and intercept them <em>before</em> a new request is made on the server.
This is a little tricky to make work with a single page app,
but we do not need to re-invent the wheel,
as both AngularJs and EmberJs come with this built in.</p>
<p>This is a clear improvement on the hash fragment method,
but there is a catch: not all browsers support it -
only the more recent versions of each do.
See <a href="http://caniuse.com/history" target="_blank">this chart</a>
for the exact browsers and versions.</p>
<p>The History API is an improvement on hash fragments,
and we should try to use it where we can,
and fall back on hash fragments in other cases.</p>
<h3 id="routing-and-state-machines">Routing and State Machines</h3>
<p>State machines are a mathematical concept which has found practical application
in a number of things ranging from circuit board design to -
you guessed it - routing in single page applications.</p>
<p>There are two main types of state machines that are of interest to us
in the context of single page applications:
<a href="http://en.wikipedia.org/wiki/Finite-state_machine" target="_blank">finite state machines</a>
and <a href="http://en.wikipedia.org/wiki/UML_state_machine#Hierarchically_nested_states" target="_blank">hierarchical state machines</a>.</p>
<p>A Finite State Machine is one that defines a number of states that
an app (the <em>machine</em>), can be in.
The app is only allowed to be in one state at any point of time.
The finite state machine also must define a series of transitions,
between one state and another, and the triggering conditions for each of them.</p>
<p>A hierarchical state machine is a more complex version of a finite state machine.
It allows any state to define an entire finite state machine within itself.
This may be done recursively, and the end result is a hierarchy of states.
The same rules regarding states and transitions still apply,
however due to the hierarchy, there is one interesting property -
there may be more than one state active at a time.
Between sibling states in one finite state machine,
only one of them may be active at any one point of time, and this still holds true.
However, if this state contains a finite state machine of its own,
amongst its child states, one of them is allowed to be active as well.</p>
<p>This is all rather theoretical - what is the application of
state machines to single page apps?</p>
<p>Routers are objects that provide routing functionality.
Both AngularJs and EmberJs have implemented their routers using state machines.</p>
<p>The router objects store the URL and MVC state for each route in the app
in a state machine.</p>
<p>The state machine is particularly useful in managing transitions between one
route and another; in particular,
transitions come in handy too add hooks to set up or tear down each state.
This would include things like re-rendering a section of the DOM,
and adding/ removing listeners.
These are key parts of &quot;plumbing&quot; type work that a single page application
framework takes care of -
grunt work that happens behind the scenes that would be very tedious
(not to mention boring) to do by hand each time.
Tedious,  but extremely important.
It ensures that the state is correctly in one or another,
and not in some indeterminate or in between state that could be hard to recover from.
It also ensures that the app is performant, and does not suffer from things
such as memory leaks due to stale event listeners for DOM elemtns that no longer exist.</p>
<h3 id="data-retrieval-callbacks-and-promises">Data Retrieval: Callbacks and Promises</h3>
<p>Whe  we retireve data over the network in a single page application,
we use AJAX (asynchronous Javasctip and XML).
The <code>XMLHttpRequest</code> global object,
implemented natively in all browsers since IE5,
provides the AJAX functions.
Using the raw <code>XMLHttpRequest</code> objects, however, is rather unwiedly,
and in order to avoid having to repeating a lot of cruft code each time
this needs to be done, we use wrapper objects.
AngularJs defines a the <code>$http</code> module that fills this role,
while EmberJs uses <code>jQuery</code>&#39;s AJAX functions.</p>
<p>Javscript, however, is has been single threaded<sup>&lowast;</sup> from the get-go,
and this poses a fundamental problem for AJAX, due to its asynchronous nature.
If we were to block execution of the main Javscript thread
until AJAX requests returned, we would be in for a pretty laggy experience on the web.
There is thus a need to be be able to execute code asynchronously.
There are two ways in which this is solved: callbacks and promises.</p>
<p>Callbacks are the de facto way to run Javascript asynchrnonously.
As functions are first class objects in Javascript,
we simply pass in a function that should get executed when the asynchronous code
returns.
That function is referred to as the callback function.
In the case of an AJAX request, the callback function would typically parse or
do something else with the result returned from the server.</p>
<p>That is pretty neat, but callbacks do have their limitations.
Imagine if you wanted to do two tasks that are both asynchronous,
but need the second one to execute only when the first one has completed.
The way to do this would be for the callback function to nest another callback function.
If there are three or more things like this,
you begin to get some really messy code,
characterised by its shape - it looks like a triangle on its side.</p>
<p>Promises overcome this limitation,
by wrapping callback function in promise objects, making it easier to reason
about them in sequences or other types of series and groups.
THe more modern Javascript libraries have embraced promises
as the go to means of dealing with asynchronous code.
AggularJs contains its own promise module,
<a href="https://docs.angularjs.org/api/ng/service/$q" target="_blank"><code>$q</code></a>;
and EmberJs has its own promise library,
<a href="http://emberjs.com/api/classes/Ember.RSVP.html" target="_blank"><code>RSVP</code></a>.
Both implmentations follow a common specification, the
<a href="http://promises-aplus.github.io/promises-spec/" target="_blank">Promises/A+ spec</a>,
thus their syntax is almsot identical.</p>
<p><sup>&lowast;</sup> The next edition of the ECMAScript specification, ES6 Harmony,
includes a <a href="http://wiki.ecmascript.org/doku.php?id=strawman:concurrency" target="_blank">proposal for concurrency</a>,
and a <a href="http://wiki.ecmascript.org/doku.php?id=harmony:generators" target="_blank">draft for generators</a>.
The latter, generators, has already been implemented in NodeJs,
and is due to come to browsers shortly.</p>
<h3 id="discussion">Discussion</h3>
<p>We have taken a look at what routing is,
and why it continues to be important and relevant in single page applications.
We have also looked at the two different ways in which URLs
work in single page applications: hash fragments and the HTML5 History API.</p>
<p>Finally we have taken a look at the concept of state machines,
and the crucial role that they play in enabling routing
in both AngularJs and EmberJs.
These frameworks use different types of state machines - finite and hierarchical.
impacts the routing functionality that each can support,
and we will examine this in greater detail in the next article.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../mvc/controllers.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../adv/routers.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
